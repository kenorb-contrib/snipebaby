
--- WDDA ---
Инструкция по установке и настройке приложения оплаты через сервис Robokassa к компоненту JoomShopping. WDDA. Stable ver 2.0 beta.

приложение тестировалось на следующих связках:

    Joomla 2.5.3 + JoomShopping 3.5.1 — тестовый аккаунт
    Joomla 1.7.3 + JoomShopping 3.2.7 — тестовый аккаунт и рабочий аккаунт
    Joomla 1.7.0 + Joomshopping 3.2.7 — тестовый аккаунт
    Joomla 1.5.8 + Joomshopping 2.9.7 — тестовый аккаунт

по ряду причин у нас не было возможности протестировать активированный аккаунт на всех из представленных версий, так что мы ждем ваших отзывов, чтобы дополнить эту таблицу теперь уже вашими тестами работоспособности ;)
--- ---- ---

1. Для начала вам нужно будет создать аккаунт на сайте <a href="https://www.roboxchange.com/Environment/Partners/Reg/Register.aspx?reg=Merchant&culture=ru">Регистрация</a>
Для создания аккаунта понадобится номер счёта (электронный кошелёк из предложенных вариантов), на который будут производиться оплаты заказов.
(После создания аккаунта, перед его активацией, у вас ещё будет возможность протестировать систему, изменить личные данные).

2. После создания, будет сразу же предложено ввести данные: пароль 1, пароль 2, Result URL, Success URL, Fail URL, Методы отправки данных. (Это вкладка "администратирование", вы увидите её, как только зайдёте под своим логином)
Пароли стоит придумать посложнее, в любом случае, понадобятся они только один раз, чтобы потом их заполнить в вашу Joomla, но об этом попозже.
Следующие поля заполните, в соответствии с именем вашего интернет-магазина:

RESULT URL  :  http://ИМЯ-ВАШЕГО-САЙТА/index.php?option=com_jshopping&controller=checkout&task=step7&js_paymentclass=pm_robokassa
SUCCESS URL :  http://ИМЯ-ВАШЕГО-САЙТА/index.php?option=com_jshopping&controller=checkout&task=step7&act=success&js_paymentclass=pm_robokassa
FAIL URL    :  http://ИМЯ-ВАШЕГО-САЙТА/index.php?option=com_jshopping&controller=checkout&task=step7&act=cancel&js_paymentclass=pm_robokassa

Метод передачи данных выберите "POST".
С настройками робокассы на данном этапе закончено. Сейчас, так как наш аккаунт не активирован, робокасса работает в режиме тестирования (все операции проводятся без оплаты заказов и без ввода реквизитов)

3. Установим дополнение к JoomShopping Robokassa. Нужно зайти в админку Joomla! и там выбрать компонент JoomShopping. В раскрывающемся выпадающем меню, выберите "установка и обновление". (Нужно "установка и обновление" именно самого компонента JoomShopping, а не Joomla). Загрузите zip архив дополнения.

4. Теперь можно перейти к настройкам дополнения robokassa. Зайдите в компоненты -> JoomShopping -> Опции -> Способы оплаты -> Robokassa -> Конфигурация.
Тестовый режим: если включена данная опция, то перенаправление на оплату товара будет производиться на тестовый сервер робокасса. После того, как активируете аккаунт на Робокасса, переключите эту опцию в позицию "нет".
Пароль #1, Пароль #2 - это пароли, которые вы ввели при создании аккаунта Робокасса. Они нужны для проверки возвращаемых данных, чтобы уберечь вашу систему оплаты от злоумышленников.
Логин - это имя аккаунта на Робокасса.

Теперь перейдите в другую вкладку "Настройка валют". Здесь показаны все существующие валюты, созданные в вашем компоненте Joomshopping, рядом с ними — выпадающий список выбора передаваемой валюты (об этом далее) и внутренний курс валюты вашего магазина.
Выберите для каждой валюты в какую валюту оно будет сконвертирована цена товара на сервисе Робокасса. Скажем, если начальная цена товара 100 рублей и вы хотите, чтобы эта цена передалась в долларах, то выберите, например WMZ. Робокассе будет передана цена 100 рублей и валюта, в которую она эту цену и конвертирует по текущему курсу. Теперь, покупая этот товар, клиент попадет на сервис робокасса, где ему будет предложено заплатить около 3,5 WMZ.

Для одной валюты на сайте этого достаточно, чтобы модуль функционировал верно. Для нескольких валют - выставьте передаваемое значение и проверьте их курс, указав 1.0000 основной валюте (лучше, если это будет валюта, в которой вы получаете деньги на робокассе - это могут быть рубли или доллары)

5. Подробнее про валюты.

Если вы используете несколько валют на сайте, то наверняка у вас стоит модуль Joomshopping 'Currencies'. Он преобразует цену используя внутренний курс вашего магазина (прописываемый вами же). Скажем, если товар стоит 100 рублей, то чтобы показать его в долларах, модуль делит это значение (конечно, если рубли — это главная валюта вашего сайта, со значением курса 1.00000) на тот коэффициент, который вы укажите в опциях->валюты. 
Скажем, выводится 3,0 доллара сша (если у вас внутренний курс вашего магазина 0.03). Теперь, чтобы это значение верно передалось, нужно конвертировать эту сумму в ту валюту, которая используется для приема денег по-умолчанию на вашем аккаунте робокасса. Т.е. наш модуль обратно конвертирует из долларов в рубли то, что конвертировал Joomshopping Currencies. Иными словами, 3,0 долларов теперь делятся на тот же самый введенный вами в настройках валюты коэффициент (в нашем случае 0.03) и мы снова получаем 100рублей, которые можем теперь передать в любой валюте.
К примеру, вы выбрали передаваемую валюту WMZ, тогда робокасса получит число 100 и валюту WMZ и конвертирует ее по текущему курсу. Несостыковка может быть в том, что курс робокассы может отличаться от вашего внутреннего курса магазина, тогда клиент не получит в итоге сумму в 3 доллара, а может получить 3,5 доллара или, наоборот, 2.5. Здесь можно сделать только одно — точнее согласовать внутренний курс с реальным курсом валюты на робокассе. 
Сразу отвечу на вопрос. Нельзя передавать стоимость сразу в долларах. Передавать стоимость можно только в той валюте, которую вы получаете деньги на этом аккаунте робокассы. Конечно, если у вас аккаунт принимает деньги в долларах, то доллары передадутся без проблем. Если же у вас по умолчанию — рубли, возможны отклонения вызванные, как я уже говорил, несостыковкой курсов валют вашего магазина и сервиса робокасса.


    Изменения в модуле 2.0:

   — Поддержка мультивалютности
   — Поддержка мультиязычности (пересылает на английскую версию сервиса Робокасса, если пользователь отправился с англоязычной страницы)
   — Исправлена поддержа языков — теперь языковые файлы находятся отдельно от общих языковых файлов joomShopping, означает — после обновления магазина они не затрутся.
   — Улучшен способ выбора валют — теперь загружаются поддерживаемые валюты вашего аккаунта в выпадающий список, используя API Робокасса.
   — Было уделено большее внимание тестированию.
   
Спасибо всем, кто оставлял ваши отзывы по поводу этого приложения. Положительные отзывы убедили нас в том, что этот компонент нужен людям и потому есть смысл его развивать. Отзывы о неправильной работе помогли нам исправить ошибки в тех ситуациях, которые мы не учли на момент разработки. Так или иначе, без вас этого приложения бы не было. Надеемся, что комьюнити Joomla! не останется равнодушным к новой версии этого модуля.